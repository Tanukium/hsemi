## 行と列の引数伝達をPOSTからGETに移行

POSTメソッドの使い方を書いた回では既に説明したが、訳が分からないが`app.post()`関数は`routes/`フォルダのサブルータに書き込めなく、`app.js`にしか書き込めないらしい。  
そのため、まずは`app.js`にある、`app.post('sand'`から始まるブロックを削除してからセーブする。

次は`routes/sand.js`（`サイト/sand`をコントロールするサブルータファイル）を開き、唯一の`router.get`から始まるブロックの中にある、`res.render`関数のパラメータを編集する。  
`rowNum: 5`と`colNum: 6`を削除して、代わりに下の一行を書き込む。

```
row: `${req.query.row}`, col: `${req.query.col}`
```

GETメソッドを使うリクエストも、`{key: value}`の形のObjectオブジェクトである。  
しかし、リクエストが含むキーの値（バリュー）を呼び出すメソッドは`req.body`ではなく、`req.query`になった。  
これも何度も試行錯誤した私が先生から（何回目かもう覚えられない）いただいたアドバイスであった。

私の力ではデフォルトで渡す値がセットできないので、サブルータファイルの、リクエストを処理してリスポンスをクライエント側に返す、`router.get(){res.render()}`ブロックを簡単に書き換えた。  
そのブロックが`row`と`col`という、Expressがブラウザに渡す引数を二つ作った上で、GETで発送された`{row: hoge, col: fuga}`のようなリクエストの値を引数にそれぞれ渡す。  
その後、二つの引数をリスポンスとして返す。これは今回書き換えたそのブロックのロジックである。

最後は`views/sand/index.pug`にGETを応用させた話だが、それは次の「テーブル生成をサーバ側に移行」というトピックにも関連しているので、そこで説明させていただく。

***

## テーブル生成をサーバ側に移行

今度の移行は、完全に``views/sand/index.pug`を編集するだけでいい仕事だった。

徹底した移行なので、まずは`block script`から始まるブロックの、`script(type="text/javascript").`以下の（その行自体は含まれない）内容を全部削除する。  
ただし、次回の保存機能を考えて、テスト用の`test`関数を一つ作る必要がある。

```
let test = () => {
    alert("Test");
}
```

以上の内容を`script(type="text/javascript").`の下に補充すればいい。

次は、もう一つ新たなPug文法を紹介しよう。それは、「出力しないコード」（Unbuffered Code）機能である。

Pugのドキュメントでは、`-`というマークを紹介した。そのマークで始まる行は、文字としてページに出力することなく、JavaScriptとして実行する。  
もっと面白いのは、その行が直接にPug文法のHTMLエレメントも処理できる。  
例えば、以下のブロックは望まれる『「item」というエレメントを三行のリストで出力する』との効果が実現できる：

```
- for (var x = 0; x < 3; x++)
  li item
```

しかし、Pugのドキュメントはそのマークの全ての機能を説明していないらしい。例えば、`-`マークから始まる行では、Expressから渡した引数を直接名前で呼び出す特性がある。  
すなわち、わざわざ`#{hogehoge}`のような記法を使う必要はなくなる。これがグーグルで入手した豆知識だったが、案外役に立ったものである。

一方で、HTML言語での（もっともシンプルな）テーブルとは、行を作る`<tr>`とセルを作る`<td>`エレメントの組合せである。そのため、Pugではただこう書けばテーブルが作れる：

```
table
  - for( let i = 0; i < row; i++ )
     tr
      - for( let j = 0; j < col; j++)
        td
```

`i`と`j`は、行数と行ごとに含まれるセル数（すなわち列数）である。ただし、このプロジェクト用のテーブルには入力用のテキストエリアが含まれるはずである。  
なので、`td`の下にテキストエリアを挿入する：

```
td
  input(type="text" size="5")
```

それで終わったと思ったら、先生に（軽く）報告したらもう一つのアドバイスをいただいた。セルごとに、何か見分ける用の属性をつけたほうがいいということであった。  
それは、これからセルの型付けなどの機能を作るための準備だと先生がそう説明なさった。

最終は、私たちがこのようなコードをもらった：

```
table(id="demo")
  - for( let i = 0; i < row; i++ )
    tr
      - for( let j = 0; j < col; j++)
        td(class=i+':'+j)
          input(type="text" size="5")
```

`<div>`と`<span>`タグが意味なく段落を分けるもののように、`class`タグも変数のように単純に何かの「値」を貯蔵するものなので、こちらで使った。  
この下に`br`で段落内改行をしてから、仮の保存機能用のボタン一つを作る：

```
br
button(onclick="test()") 保存
```

これで、Pugの「出力しないコード」を使って、テーブルを作る機能をサーバ側に移行した。

***
