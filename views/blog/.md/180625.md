# 開発日誌：180625

## 発表を兼ねて、次の目標を見定める
***

### 1. 中間発表
***

ゼミの先生が「6月25日か7月1日に一回中間発表をしよう」と私たちのゼミ生に教えたので、今回のゼミ前半は主に中間発表をして見た。  
発表の内容はほぼこのブログに載せる内容と同じなので、ここでは割愛。ただし、三つ補足したいものがあり、それについて述べる。

#### （1） JSでテーブルを書くことを分析する

W3CSchoolのHTML Tableドキュメント、JS DOMのドキュメントと『JavaScript本格入門』を読んでから、私はJSの基本文法と、実験場に置いておいたサンプルコードのロジックを大体わかった。とりあえずここでは、いつかの要点を書こう。  
* JSでは、変数を定義するためにはlet(ES6の前のES5スタンダードならvar)が使われる。そして関数を定義するには特にdefなどのキーワードはなく、だた`let 関数名 = (変数) => {関数式}`のような書き方だけでいい。  
* 一方、ES5スタンダードでは、書き方が`var 関数名 = function(変数名){関数式}`である。ES6がES5との互換性があるので、そういう書き方はES6でも通用する。
* forループの書き方は、CとJavaに似ている。詳しくは、`for(let 変数 = int; 変数の判断条件; 変数の変化式){ロープ内容}`である。
* DOMは、「Document Object Model」の略である。つまり、ウェブサイトの内容（画像、音声と動画なども含めて）をオブジェクトとして扱うモデルである。もっと簡単に言えば、JSを直接にHTMLを処理させるため、HTMLをオブジェクト化するクラスみたいなものである。
* HTMLのタグは、JSのDOMで「ノード」として扱われている。この「ノード」は、DOMの一番小さな（基本）オブジェクトであり、他のJSオブジェクトと同じく属性（attribute）の集合である。
  * `<table><tr><td></td></tr><table>`のような構造が、DOMでは「\<table\>という親ノード->\<tr\>という子ノード->\<td\>という子ノード」のように、いくつかのノードがそれぞれ貼り付けているという関係で解釈される。
  * そこで、私たちはDOM#getElementByIdメソッドでHTMLの<body>（他の部分ももちろんできる）タグの中にある、特定のidという属性のタグをオブジェクトとして読み取れ、とある変数と結び付けられる。
  * さらに、DOM#createElementメソッドを使って新たなノード（HTMLタグ）を作ることもでき、DOM#appendChildメソッドを使って親ノードに貼り付けることもできる。
* ネットで入手したサンプルコードのやり方についても説明する。
  * まず関数を一つ構造して、その中でDOM#getElementByIdを使って特定のid属性がある\<table\>ノードを読み取って変数と結び付ける。
  * 次に、二重forループとDOM#createElementメソッドを組み合わせて10つの行と行内の10つのセルを作るコードを関数に書き込む。
  * それから、DOM#appendChildで行にセルを、テーブルに行を入れたコードも関数に書き込む。
  * 最後は関数の下でwindow.onloadメソッド（オブジェクト？）に*さき構造した関数を呼び出す関数*を値として渡せば、ページがロードした直後にすぐデーブル（表）を作れるようになった。
  * ただし、window.onloadに構造した関数を直接渡してはいけないらしい。私の場合、そうするとコードが全然動かなかった。

ところで、window.onloadは一体どういうものだろう。検索してみたら、まずonloadメソッドはDOM Eventオブジェクトということがわかった。しかし、window自体はBOM（Browser Object Model）オブジェクトなんだ。そうからしては、BOMとDOMの間では何か継承関係とかのものがあるではないだろうか。それを解明しなければならない。

#### （2） BOMとDOMの関係を説明する

幸いに、ググったらBOMとDOMの関係を説明するページはたくさん出た。とりあえず手に入れた写真一枚を載せよう。

![180625-1.jpg][1]

この写真が示したように、BOMオブジェクトはwindowを含めたオブジェクトなのである。えっと、ここでは実は「BOMオブジェクト＝windowオブジェクト」といっていいようである。なぜかというと、windowオブジェクトはBOMオブジェクトのルートノート（すべてのノートの親ノート）からである。

そしてdocumentオブジェクトも同じく「すべてDOMオブジェクトのノートの親ノート」で、いわゆるDOMオブジェクトのルートノートである。

さらに、windowオブジェクトはなんとdocumentオブジェクトの親ノート……らしい。

なので、ここでは

* BOM≈window
* DOM≈document
* document=window.document

という関係を見つけた。つまり、BOM⊇DOM（BOMがDOMを含めている）といっていいので、window.(document.)onloadのような使い方も納得できる。

もうちょいと補足すれば、DOMオブジェクトは「ウェブサイトの内容を変えるオブジェクト」で、BOM（window）オブジェクトは「ブラウザをコントロールするオブジェクト」なのである。もともとウェブサイトはブラウザの中で開かれなければならないので、BOMがDOMを含めているといった結論を得てもおかしくないかな、と私はそう思う。

#### （3） サンプルコードを書き直す

サンプルコードのロジックをもうわかったうえで、そろそろサンプルコードを改造しなきゃと思った。  
改造のプランは、セル（\<td\>）の中に数字ではなく、テキストエリア（\<input\>）のノードを貼り付けることである。  
なので、私は`col.innerHTML = (i*10)+j+1`の一行を削除してから、`row.appendChild(cell);`の前に

```
let text = document.createElement("INPUT"); //<input>エレメント（入力エリア）を作る
text.setAttribute("type", "text"); //HTML DOM　setAttributeメソッド：エレメントの属性（attribute）をvar1, var2の形で設置する
text.setAttribute("size", "5");
cell.appendChild(text); //HTML　DOM　appendChildメソッド：変数のエレメント(text)を子ノードとして親ノードのオブジェクト(cell)の下に添付する
```

を書き込んだ。実行ロジックの説明はもうコメントアウトしたので、ここでは割愛。

さらに、二つのforループを含めているテーブルを書く関数をmakeTableという変数に渡して、その関数に`rowNum`、`colNum`といった変数を二つ持たせた。それからforループの条件判断の中に変数を導入すれば、`makeTable(rowNum, colNum)`の変数を変えるだけで表の行数と列数を定義できるようになる。

### 2. 次の目標
***

#### （1） POSTメソッドで任意の大きさの表を作れる機能を加えつける

発表が終わったら、私はすぐpostメソッドで任意の大きさの表を作れる機能を加えつけるように頑張りはじめた。

いろいろと調べたら、もともと古いバージョンのExpressはPOSTメソッドを導入する前に`body-parser`といったパッケージをインストールする必要があったが、最新バージョンはもうなくなったそうである。ただし、私は`./routes`のサブルータファイルの中でpostメソッドを導入したかったが、どう実験しても./app.jsの中でしか導入できない模様である。

では、さっそく実験の手順を説明しよう。

* `./sand`の下にform.ejsというファイルを作る。その中に、`<body>`タグの中に
  ```
  <form action="#" method="post">
    <input type="text" name="row"></input>
    <input type="text" name="col"></input>
    <input type="submit"></input>
  </form>
  ```  
  という内容を書きこんで、保存する。
* `./app.js`を開き、`app.use('/sand', sandRouter);`の下に
  ```
  app.post('/sand/form', function(req, res) {
    console.log(req.body);
    res.send(`行数は${req.body.row}、列数は${req.body.col}`);
  });
  ```  
  という内容を書き込み、実験用のPOSTメソッドを導入した。
* Expressを起動する。127.0.0.1:8080/sand/formにアクセスする。ページの入力欄に任意の数字を書き込んで、「送信」ボタンを押す。
* すべてうまくいけば、「行数は*、列数は*」といった内容のページが出て、サーバコンソールにも`{ row: '*', col: '*' }`が出力するはずである。

一つ補足したいものだが、JSスタンダードのES2015がMapオブジェクトを導入したが、PythonのDictクラスのオブジェクトみたいな`{key: value}`のものがJSではObjectオブジェクトと呼ばれるのである。`Dict.get(key)`のようなメソッドがJSでは`Object[key]`あるいは`Object.key`に変わるのである。  
私は`res.body`をコールしたいときコールの仕方と`res.body`のクラスがわからなくて、先生に聞いたら上記のこと（知識）を手に入れた。

#### （2） 先生からの（さらなるの）アドバイス

作ったpostページを先生に見せたら、（例の）いくつかのアドバイスをいただいた。

* 手間がかからないためにejsからpugに移行したほうがいい
* Pugの文法を使って今の「表づくり」関数をクライアント側で動くからサーバ側で動くことに移行
* Bootstrapを使ってテーブル（表）をよりきれいにする

それからの話だが、実際にpug+markdown-itの組合せを試してみたら、その便利さをやっとわかった。pug+markdown-itはまさにネ申。`extends`と`include:`はもっともだ。

***
[前のページに戻る][]


[前のページに戻る]: /blog "ブログ"
[1]: /images/180625-1.jpg "180625-1"
