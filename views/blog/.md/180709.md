# 180709：POSTメソッドで任意の大きさのテーブルを作る

## Expressの中でPOSTメソッドを使う

Expressは、`app.get`、`router.get`と`app.post`メソッドでGET・POSTのリクエストを処理して、  
`res.render`と`res.send`メソッドで要求されたリソースをレスポンスしてあげる。

今回、私はまず`routes/`フォルダの下のルータファイルの中で`router.post`メソッドを使ってPOSTメソッドをコールしてみたが、  
なぜかうまく作動できなかったらしい。なんだかPOSTメソッドだけは特別に扱われていた気がするなー。  
とりあえず、`app.js`のなかで`app.post`をコールして、POSTメソッドを使ってみよう。

***

`views/sand/`の下に`form.pug`を作って、

```
extends ../layout

block content
  form(action="#", method="post")
    input(type="text", name="row")
    input(type="text", name="col")
    input(type="submit")
```

のようなコードを記入してセーブすることで、簡単なPOSTメソッドを使うフォームを含めるページを作った。  
さきいった通りに`routes/sand.js`の中に`router.post`を使えないので、今回は`app.js`の中に直接`本サイト/sand/form`のリクエスト・レスポンスのペアを書いてみよう。

`app.js`を開き、ルータファイルを定義する文（`app.use('/sand', sandRouter);`）の下に次のような文を書き込む：

```
app.post('/sand/form', function(req, res) {
    console.log(req.body);
    res.send(`行数は${req.body.row}、列数は${req.body.col}`);
```

セーブしてExpress本体を再起動することで、`本サイト/sand/form`へPOSTメソッドの付着を完了した。

テストして、次のような画面が出てきた。

![180709-1.jpg][1]

試しに一番目のコラムに10、二番目のコラムに20を入力して送信を押したら、

![180709-2.jpg][2]

が出てくると同時にコンソールが

![180709-3.jpg][3]

という内容をスクリーンにプリントアウトした。うまく動いているね。

***

上の内容は一見すごく簡単なものだったが、実は最初は一つの難しい疑問に止めさせられていた。  
それは、「`res.body`は何」とのこと。

ググると、`app.post`がPOSTリクエストを処理したらレスポンスしてあげたリソースは`res.body`ということをわかった。  
私は`app.post`の中に`console.log(res.body);`を書き込んだのでコンソールを見て直観的に`res.body`の格式をわかる。  
`{ key: value }`のようなものである。これはPythonのDictオブジェクトじゃないか、と思って、`row.body[key]`を書いてvalueをコールしてみた。  
だが、エラーが出てしまった。コールの仕方はそうではないらしい。『JavaScript本格入門』を読んだら「JSではhashのようなものをMapオブジェクトとして扱われてる」との内容を知って、`get(key)`


***

[前のページに戻る][]


[前のページに戻る]: /blog "ブログ"
[1]: /images/180709-1.jpg "1"
[2]: /images/180709-2.jpg "2"
[3]: /images/180709-3.jpg "3"
